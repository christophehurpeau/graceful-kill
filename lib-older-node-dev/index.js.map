{"version":3,"sources":["../src/index.js"],"names":["logger","process","SIGTERMTimeout","Promise","exitCode","signalCode","warn","resolve","killTimeout","setTimeout","kill","removeAllListeners","once","code","signal","info","clearTimeout"],"mappings":";;;;;;AAAA;;;;;;;;;;AAEA,IAAMA,SAAS,gCAAW,eAAX,CAAf;;kBAEe,eAACC,OAAD;AAAA,MAAUC,cAAV,uEAAmC,IAAnC;;AAAA,4BAAwB,8BAAxB;;AAAA;;AAAA,SACb,IAAIC,OAAJ,CAAY,mBAAW;AACrB,QAAIF,QAAQG,QAAR,KAAqB,IAArB,IAA6BH,QAAQI,UAAR,KAAuB,IAAxD,EAA8D;AAC5DL,aAAOM,IAAP,CAAY,wBAAZ;AACA,aAAOC,SAAP;AACD;AACD,QAAMC,cAAcC,WAAW,YAAM;AACnCT,aAAOM,IAAP,CAAY,6BAAZ;AACAL,cAAQS,IAAR,CAAa,SAAb;AACD,KAHmB,EAGjBR,cAHiB,CAApB;;AAKAD,YAAQU,kBAAR;AACAV,YAAQW,IAAR,CAAa,MAAb,EAAqB,UAACC,IAAD,EAAOC,MAAP,EAAkB;AACrCd,aAAOe,IAAP,CAAY,SAAZ,EAAuB,EAAEF,IAAF,EAAQC,MAAR,EAAvB;AACA,UAAIN,WAAJ,EAAiBQ,aAAaR,WAAb;AACjBD;AACD,KAJD;AAKAN,YAAQS,IAAR;AACD,GAjBD,CADa;AAAA,C","file":"index.js","sourcesContent":["import Logger from 'nightingale-logger/src';\n\nconst logger = new Logger('graceful-kill');\n\nexport default (process, SIGTERMTimeout: number = 4000) =>\n  new Promise(resolve => {\n    if (process.exitCode !== null || process.signalCode !== null) {\n      logger.warn('process already exited');\n      return resolve();\n    }\n    const killTimeout = setTimeout(() => {\n      logger.warn('timeout: sending SIGKILL...');\n      process.kill('SIGKILL');\n    }, SIGTERMTimeout);\n\n    process.removeAllListeners();\n    process.once('exit', (code, signal) => {\n      logger.info('stopped', { code, signal });\n      if (killTimeout) clearTimeout(killTimeout);\n      resolve();\n    });\n    process.kill();\n  });\n"]}