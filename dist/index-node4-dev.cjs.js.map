{"version":3,"file":"index-node4-dev.cjs.js","sources":["../src/index.js"],"sourcesContent":["import Logger from 'nightingale-logger/src';\n\nconst logger = new Logger('graceful-kill');\n\nexport default (process, SIGTERMTimeout: number = 4000) =>\n  new Promise(resolve => {\n    if (process.exitCode !== null || process.signalCode !== null) {\n      logger.warn('process already exited', { pid: process.pid });\n      return resolve();\n    }\n    const killTimeout = setTimeout(() => {\n      if (process.exitCode !== null || process.signalCode !== null) {\n        logger.warn('kill timeout: process already exited', { pid: process.pid });\n        return resolve();\n      }\n\n      logger.warn('kill timeout: sending SIGKILL...', { pid: process.pid });\n      process.kill('SIGKILL');\n    }, SIGTERMTimeout);\n\n    process.removeAllListeners();\n    process.once('exit', (code, signal) => {\n      logger.info('stopped', { pid: process.pid, code, signal });\n      if (killTimeout) clearTimeout(killTimeout);\n      resolve();\n    });\n    process.kill();\n  });\n"],"names":["logger","Logger","process","SIGTERMTimeout","Promise","exitCode","signalCode","warn","pid","resolve","killTimeout","setTimeout","kill","removeAllListeners","once","code","signal","info","clearTimeout"],"mappings":";;;;;;;AAEA,IAAMA,SAAS,IAAIC,MAAJ,CAAW,eAAX,CAAf;;AAEA,aAAe,UAACC,OAAD;MAAUC,cAAV,uEAAmC,IAAnC;;4BAAwB,UAAxB;;;SACb,IAAIC,OAAJ,CAAY,mBAAW;QACjBF,QAAQG,QAAR,KAAqB,IAArB,IAA6BH,QAAQI,UAAR,KAAuB,IAAxD,EAA8D;aACrDC,IAAP,CAAY,wBAAZ,EAAsC,EAAEC,KAAKN,QAAQM,GAAf,EAAtC;aACOC,SAAP;;QAEIC,cAAcC,WAAW,YAAM;UAC/BT,QAAQG,QAAR,KAAqB,IAArB,IAA6BH,QAAQI,UAAR,KAAuB,IAAxD,EAA8D;eACrDC,IAAP,CAAY,sCAAZ,EAAoD,EAAEC,KAAKN,QAAQM,GAAf,EAApD;eACOC,SAAP;;;aAGKF,IAAP,CAAY,kCAAZ,EAAgD,EAAEC,KAAKN,QAAQM,GAAf,EAAhD;cACQI,IAAR,CAAa,SAAb;KAPkB,EAQjBT,cARiB,CAApB;;YAUQU,kBAAR;YACQC,IAAR,CAAa,MAAb,EAAqB,UAACC,IAAD,EAAOC,MAAP,EAAkB;aAC9BC,IAAP,CAAY,SAAZ,EAAuB,EAAET,KAAKN,QAAQM,GAAf,EAAoBO,IAApB,EAA0BC,MAA1B,EAAvB;UACIN,WAAJ,EAAiBQ,aAAaR,WAAb;;KAFnB;YAKQE,IAAR;GArBF,CADa;CAAf;;;;"}