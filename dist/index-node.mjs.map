{"version":3,"file":"index-node.mjs","sources":["../src/index.ts"],"sourcesContent":["import type { ChildProcess } from \"node:child_process\";\nimport { Logger } from \"nightingale-logger\";\n\nconst logger = new Logger(\"graceful-kill\");\n\nexport function gracefulKill(\n  process: ChildProcess,\n  SIGTERMTimeout = 4000,\n): Promise<void> {\n  return new Promise((resolve) => {\n    if (process.exitCode !== null || process.signalCode !== null) {\n      logger.warn(\"process already exited\", { pid: process.pid });\n      resolve();\n      return;\n    }\n    const killTimeout = setTimeout(() => {\n      if (process.exitCode !== null || process.signalCode !== null) {\n        logger.warn(\"kill timeout: process already exited\", {\n          pid: process.pid,\n        });\n        resolve();\n        return;\n      }\n\n      logger.warn(\"kill timeout: sending SIGKILL...\", { pid: process.pid });\n      process.kill(\"SIGKILL\");\n    }, SIGTERMTimeout);\n\n    process.removeAllListeners();\n    process.once(\"exit\", (code: number | null, signal: string | null) => {\n      logger.info(\"stopped\", { pid: process.pid, code, signal });\n      if (killTimeout) clearTimeout(killTimeout);\n      resolve();\n    });\n    process.kill();\n  });\n}\n\nexport default gracefulKill;\n"],"names":[],"mappings":";;AAGA,MAAM,MAAA,GAAS,IAAI,MAAA,CAAO,eAAe,CAAA;AAElC,SAAS,YAAA,CACd,OAAA,EACA,cAAA,GAAiB,GAAA,EACF;AACf,EAAA,OAAO,IAAI,OAAA,CAAQ,CAAC,OAAA,KAAY;AAC9B,IAAA,IAAI,OAAA,CAAQ,QAAA,KAAa,IAAA,IAAQ,OAAA,CAAQ,eAAe,IAAA,EAAM;AAC5D,MAAA,MAAA,CAAO,KAAK,wBAAA,EAA0B,EAAE,GAAA,EAAK,OAAA,CAAQ,KAAK,CAAA;AAC1D,MAAA,OAAA,EAAQ;AACR,MAAA;AAAA,IACF;AACA,IAAA,MAAM,WAAA,GAAc,WAAW,MAAM;AACnC,MAAA,IAAI,OAAA,CAAQ,QAAA,KAAa,IAAA,IAAQ,OAAA,CAAQ,eAAe,IAAA,EAAM;AAC5D,QAAA,MAAA,CAAO,KAAK,sCAAA,EAAwC;AAAA,UAClD,KAAK,OAAA,CAAQ;AAAA,SACd,CAAA;AACD,QAAA,OAAA,EAAQ;AACR,QAAA;AAAA,MACF;AAEA,MAAA,MAAA,CAAO,KAAK,kCAAA,EAAoC,EAAE,GAAA,EAAK,OAAA,CAAQ,KAAK,CAAA;AACpE,MAAA,OAAA,CAAQ,KAAK,SAAS,CAAA;AAAA,IACxB,GAAG,cAAc,CAAA;AAEjB,IAAA,OAAA,CAAQ,kBAAA,EAAmB;AAC3B,IAAA,OAAA,CAAQ,IAAA,CAAK,MAAA,EAAQ,CAAC,IAAA,EAAqB,MAAA,KAA0B;AACnE,MAAA,MAAA,CAAO,IAAA,CAAK,WAAW,EAAE,GAAA,EAAK,QAAQ,GAAA,EAAK,IAAA,EAAM,QAAQ,CAAA;AACzD,MAAA,IAAI,WAAA,eAA0B,WAAW,CAAA;AACzC,MAAA,OAAA,EAAQ;AAAA,IACV,CAAC,CAAA;AACD,IAAA,OAAA,CAAQ,IAAA,EAAK;AAAA,EACf,CAAC,CAAA;AACH;;;;"}