{"version":3,"file":"index-node20.mjs","sources":["../src/index.ts"],"sourcesContent":["import type { ChildProcess } from \"node:child_process\";\nimport { Logger } from \"nightingale-logger\";\n\nconst logger = new Logger(\"graceful-kill\");\n\nexport function gracefulKill(\n  process: ChildProcess,\n  SIGTERMTimeout = 4000,\n): Promise<void> {\n  return new Promise((resolve) => {\n    if (process.exitCode !== null || process.signalCode !== null) {\n      logger.warn(\"process already exited\", { pid: process.pid });\n      resolve();\n      return;\n    }\n    const killTimeout = setTimeout(() => {\n      if (process.exitCode !== null || process.signalCode !== null) {\n        logger.warn(\"kill timeout: process already exited\", {\n          pid: process.pid,\n        });\n        resolve();\n        return;\n      }\n\n      logger.warn(\"kill timeout: sending SIGKILL...\", { pid: process.pid });\n      process.kill(\"SIGKILL\");\n    }, SIGTERMTimeout);\n\n    process.removeAllListeners();\n    process.once(\"exit\", (code: number | null, signal: string | null) => {\n      logger.info(\"stopped\", { pid: process.pid, code, signal });\n      if (killTimeout) clearTimeout(killTimeout);\n      resolve();\n    });\n    process.kill();\n  });\n}\n\nexport default gracefulKill;\n"],"names":[],"mappings":";;AAGA,MAAM,MAAA,GAAS,IAAI,MAAA,CAAO,eAAe,CAAA;AAEzB,SAAA,YAAA,CACd,OACA,EAAA,cAAA,GAAiB,GACF,EAAA;AACf,EAAO,OAAA,IAAI,OAAQ,CAAA,CAAC,OAAY,KAAA;AAC9B,IAAA,IAAI,OAAQ,CAAA,QAAA,KAAa,IAAQ,IAAA,OAAA,CAAQ,eAAe,IAAM,EAAA;AAC5D,MAAA,MAAA,CAAO,KAAK,wBAA0B,EAAA,EAAE,GAAK,EAAA,OAAA,CAAQ,KAAK,CAAA;AAC1D,MAAQ,OAAA,EAAA;AACR,MAAA;AAAA;AAEF,IAAM,MAAA,WAAA,GAAc,WAAW,MAAM;AACnC,MAAA,IAAI,OAAQ,CAAA,QAAA,KAAa,IAAQ,IAAA,OAAA,CAAQ,eAAe,IAAM,EAAA;AAC5D,QAAA,MAAA,CAAO,KAAK,sCAAwC,EAAA;AAAA,UAClD,KAAK,OAAQ,CAAA;AAAA,SACd,CAAA;AACD,QAAQ,OAAA,EAAA;AACR,QAAA;AAAA;AAGF,MAAA,MAAA,CAAO,KAAK,kCAAoC,EAAA,EAAE,GAAK,EAAA,OAAA,CAAQ,KAAK,CAAA;AACpE,MAAA,OAAA,CAAQ,KAAK,SAAS,CAAA;AAAA,OACrB,cAAc,CAAA;AAEjB,IAAA,OAAA,CAAQ,kBAAmB,EAAA;AAC3B,IAAA,OAAA,CAAQ,IAAK,CAAA,MAAA,EAAQ,CAAC,IAAA,EAAqB,MAA0B,KAAA;AACnE,MAAO,MAAA,CAAA,IAAA,CAAK,WAAW,EAAE,GAAA,EAAK,QAAQ,GAAK,EAAA,IAAA,EAAM,QAAQ,CAAA;AACzD,MAAI,IAAA,WAAA,eAA0B,WAAW,CAAA;AACzC,MAAQ,OAAA,EAAA;AAAA,KACT,CAAA;AACD,IAAA,OAAA,CAAQ,IAAK,EAAA;AAAA,GACd,CAAA;AACH;;;;"}