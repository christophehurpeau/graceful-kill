{"version":3,"file":"index-node16.mjs","sources":["../src/index.ts"],"sourcesContent":["import type { ChildProcess } from 'child_process';\nimport { Logger } from 'nightingale-logger';\n\nconst logger = new Logger('graceful-kill');\n\nexport function gracefulKill(\n  process: ChildProcess,\n  SIGTERMTimeout = 4000,\n): Promise<void> {\n  return new Promise((resolve) => {\n    if (process.exitCode !== null || process.signalCode !== null) {\n      logger.warn('process already exited', { pid: process.pid });\n      resolve();\n      return;\n    }\n    const killTimeout = setTimeout(() => {\n      if (process.exitCode !== null || process.signalCode !== null) {\n        logger.warn('kill timeout: process already exited', {\n          pid: process.pid,\n        });\n        resolve();\n        return;\n      }\n\n      logger.warn('kill timeout: sending SIGKILL...', { pid: process.pid });\n      process.kill('SIGKILL');\n    }, SIGTERMTimeout);\n\n    process.removeAllListeners();\n    process.once('exit', (code: number | null, signal: string | null) => {\n      logger.info('stopped', { pid: process.pid, code, signal });\n      if (killTimeout) clearTimeout(killTimeout);\n      resolve();\n    });\n    process.kill();\n  });\n}\n\nexport default gracefulKill;\n"],"names":["logger","Logger","gracefulKill","process","SIGTERMTimeout","Promise","resolve","exitCode","signalCode","warn","pid","killTimeout","setTimeout","kill","removeAllListeners","once","code","signal","info","clearTimeout"],"mappings":";;AAGA,MAAMA,MAAM,GAAG,IAAIC,MAAM,CAAC,eAAe,CAAC,CAAA;AAEnC,SAASC,YAAYA,CAC1BC,OAAqB,EACrBC,cAAc,GAAG,IAAI,EACN;AACf,EAAA,OAAO,IAAIC,OAAO,CAAEC,OAAO,IAAK;IAC9B,IAAIH,OAAO,CAACI,QAAQ,KAAK,IAAI,IAAIJ,OAAO,CAACK,UAAU,KAAK,IAAI,EAAE;AAC5DR,MAAAA,MAAM,CAACS,IAAI,CAAC,wBAAwB,EAAE;QAAEC,GAAG,EAAEP,OAAO,CAACO,GAAAA;AAAI,OAAC,CAAC,CAAA;AAC3DJ,MAAAA,OAAO,EAAE,CAAA;AACT,MAAA,OAAA;AACF,KAAA;AACA,IAAA,MAAMK,WAAW,GAAGC,UAAU,CAAC,MAAM;MACnC,IAAIT,OAAO,CAACI,QAAQ,KAAK,IAAI,IAAIJ,OAAO,CAACK,UAAU,KAAK,IAAI,EAAE;AAC5DR,QAAAA,MAAM,CAACS,IAAI,CAAC,sCAAsC,EAAE;UAClDC,GAAG,EAAEP,OAAO,CAACO,GAAAA;AACf,SAAC,CAAC,CAAA;AACFJ,QAAAA,OAAO,EAAE,CAAA;AACT,QAAA,OAAA;AACF,OAAA;AAEAN,MAAAA,MAAM,CAACS,IAAI,CAAC,kCAAkC,EAAE;QAAEC,GAAG,EAAEP,OAAO,CAACO,GAAAA;AAAI,OAAC,CAAC,CAAA;AACrEP,MAAAA,OAAO,CAACU,IAAI,CAAC,SAAS,CAAC,CAAA;KACxB,EAAET,cAAc,CAAC,CAAA;IAElBD,OAAO,CAACW,kBAAkB,EAAE,CAAA;IAC5BX,OAAO,CAACY,IAAI,CAAC,MAAM,EAAE,CAACC,IAAmB,EAAEC,MAAqB,KAAK;AACnEjB,MAAAA,MAAM,CAACkB,IAAI,CAAC,SAAS,EAAE;QAAER,GAAG,EAAEP,OAAO,CAACO,GAAG;QAAEM,IAAI;AAAEC,QAAAA,MAAAA;AAAO,OAAC,CAAC,CAAA;AAC1D,MAAA,IAAIN,WAAW,EAAEQ,YAAY,CAACR,WAAW,CAAC,CAAA;AAC1CL,MAAAA,OAAO,EAAE,CAAA;AACX,KAAC,CAAC,CAAA;IACFH,OAAO,CAACU,IAAI,EAAE,CAAA;AAChB,GAAC,CAAC,CAAA;AACJ;;;;"}