{"version":3,"file":"index-node8-dev.es.js","sources":["../src/index.ts"],"sourcesContent":["import { ChildProcess } from 'child_process';\nimport Logger from 'nightingale-logger';\n\nconst logger = new Logger('graceful-kill');\n\ndeclare module 'child_process' {\n  interface ChildProcess {\n    exitCode: number | null;\n    signalCode: string | null;\n  }\n}\n\nexport default (process: ChildProcess, SIGTERMTimeout: number = 4000) =>\n  new Promise(resolve => {\n    if (process.exitCode !== null || process.signalCode !== null) {\n      logger.warn('process already exited', { pid: process.pid });\n      return resolve();\n    }\n    const killTimeout = setTimeout(() => {\n      if (process.exitCode !== null || process.signalCode !== null) {\n        logger.warn('kill timeout: process already exited', { pid: process.pid });\n        return resolve();\n      }\n\n      logger.warn('kill timeout: sending SIGKILL...', { pid: process.pid });\n      process.kill('SIGKILL');\n    }, SIGTERMTimeout);\n\n    process.removeAllListeners();\n    process.once('exit', (code: number | null, signal: string | null) => {\n      logger.info('stopped', { pid: process.pid, code, signal });\n      if (killTimeout) clearTimeout(killTimeout);\n      resolve();\n    });\n    process.kill();\n  });\n"],"names":["logger","Logger","process","SIGTERMTimeout","Promise","resolve","exitCode","signalCode","warn","pid","killTimeout","setTimeout","kill","removeAllListeners","once","code","signal","info","clearTimeout"],"mappings":";;AAGA,MAAMA,SAAS,IAAIC,MAAJ,CAAW,eAAX,CAAf;AASA,aAAe,CAACC,OAAD,EAAwBC,iBAAyB,IAAjD,KACb,IAAIC,OAAJ,CAAYC,WAAW;MACjBH,QAAQI,QAAR,KAAqB,IAArB,IAA6BJ,QAAQK,UAAR,KAAuB,IAAxD,EAA8D;WACrDC,IAAP,CAAY,wBAAZ,EAAsC;WAAON,QAAQO;KAArD;WACOJ,SAAP;;;QAEIK,cAAcC,WAAW,MAAM;QAC/BT,QAAQI,QAAR,KAAqB,IAArB,IAA6BJ,QAAQK,UAAR,KAAuB,IAAxD,EAA8D;aACrDC,IAAP,CAAY,sCAAZ,EAAoD;aAAON,QAAQO;OAAnE;aACOJ,SAAP;;;WAGKG,IAAP,CAAY,kCAAZ,EAAgD;WAAON,QAAQO;KAA/D;YACQG,IAAR,CAAa,SAAb;GAPkB,EAQjBT,cARiB,CAApB;UAUQU,kBAAR;UACQC,IAAR,CAAa,MAAb,EAAqB,CAACC,IAAD,EAAsBC,MAAtB,KAAgD;WAC5DC,IAAP,CAAY,SAAZ,EAAuB;WAAOf,QAAQO,GAAf;UAAA;;KAAvB;QACIC,WAAJ,EAAiBQ,aAAaR,WAAb;;GAFnB;UAKQE,IAAR;CArBF,CADF;;;;"}