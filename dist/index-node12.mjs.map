{"version":3,"file":"index-node12.mjs","sources":["../src/index.ts"],"sourcesContent":["import type { ChildProcess } from 'child_process';\nimport Logger from 'nightingale-logger';\n\nconst logger = new Logger('graceful-kill');\n\nexport default function gracefulKill(\n  process: ChildProcess,\n  SIGTERMTimeout = 4000,\n): Promise<void> {\n  return new Promise((resolve) => {\n    if (process.exitCode !== null || process.signalCode !== null) {\n      logger.warn('process already exited', { pid: process.pid });\n      return resolve();\n    }\n    const killTimeout = setTimeout(() => {\n      if (process.exitCode !== null || process.signalCode !== null) {\n        logger.warn('kill timeout: process already exited', {\n          pid: process.pid,\n        });\n        return resolve();\n      }\n\n      logger.warn('kill timeout: sending SIGKILL...', { pid: process.pid });\n      process.kill('SIGKILL');\n    }, SIGTERMTimeout);\n\n    process.removeAllListeners();\n    process.once('exit', (code: number | null, signal: string | null) => {\n      logger.info('stopped', { pid: process.pid, code, signal });\n      if (killTimeout) clearTimeout(killTimeout);\n      resolve();\n    });\n    process.kill();\n  });\n}\n"],"names":["logger","Logger","gracefulKill","process","SIGTERMTimeout","Promise","resolve","exitCode","signalCode","warn","pid","killTimeout","setTimeout","kill","removeAllListeners","once","code","signal","info","clearTimeout"],"mappings":";;AAGA,MAAMA,MAAM,GAAG,IAAIC,MAAJ,CAAW,eAAX,CAAf;AAEe,SAASC,YAAT,CACbC,OADa,EAEbC,cAAc,GAAG,IAFJ,EAGE;AACf,SAAO,IAAIC,OAAJ,CAAaC,OAAD,IAAa;AAC9B,QAAIH,OAAO,CAACI,QAAR,KAAqB,IAArB,IAA6BJ,OAAO,CAACK,UAAR,KAAuB,IAAxD,EAA8D;AAC5DR,MAAAA,MAAM,CAACS,IAAP,CAAY,wBAAZ,EAAsC;AAAEC,QAAAA,GAAG,EAAEP,OAAO,CAACO;AAAf,OAAtC;AACA,aAAOJ,OAAO,EAAd;AACD;;AACD,UAAMK,WAAW,GAAGC,UAAU,CAAC,MAAM;AACnC,UAAIT,OAAO,CAACI,QAAR,KAAqB,IAArB,IAA6BJ,OAAO,CAACK,UAAR,KAAuB,IAAxD,EAA8D;AAC5DR,QAAAA,MAAM,CAACS,IAAP,CAAY,sCAAZ,EAAoD;AAClDC,UAAAA,GAAG,EAAEP,OAAO,CAACO;AADqC,SAApD;AAGA,eAAOJ,OAAO,EAAd;AACD;;AAEDN,MAAAA,MAAM,CAACS,IAAP,CAAY,kCAAZ,EAAgD;AAAEC,QAAAA,GAAG,EAAEP,OAAO,CAACO;AAAf,OAAhD;AACAP,MAAAA,OAAO,CAACU,IAAR,CAAa,SAAb;AACD,KAV6B,EAU3BT,cAV2B,CAA9B;AAYAD,IAAAA,OAAO,CAACW,kBAAR;AACAX,IAAAA,OAAO,CAACY,IAAR,CAAa,MAAb,EAAqB,CAACC,IAAD,EAAsBC,MAAtB,KAAgD;AACnEjB,MAAAA,MAAM,CAACkB,IAAP,CAAY,SAAZ,EAAuB;AAAER,QAAAA,GAAG,EAAEP,OAAO,CAACO,GAAf;AAAoBM,QAAAA,IAApB;AAA0BC,QAAAA;AAA1B,OAAvB;AACA,UAAIN,WAAJ,EAAiBQ,YAAY,CAACR,WAAD,CAAZ;AACjBL,MAAAA,OAAO;AACR,KAJD;AAKAH,IAAAA,OAAO,CAACU,IAAR;AACD,GAxBM,CAAP;AAyBD;;;;"}